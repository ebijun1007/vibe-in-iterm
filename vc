#!/usr/bin/env bash
set -euo pipefail

VC_TEMPLATE_REPO="${VC_TEMPLATE_REPO:-ebijun1007/vibe-coding}"
VC_TEMPLATE_REF="${VC_TEMPLATE_REF:-master}"
VC_CORE_PATH="${VC_CORE_PATH:-scripts/vc-core.sh}"
VC_REMOTE_URL="${VC_REMOTE_URL:-https://raw.githubusercontent.com/${VC_TEMPLATE_REPO}/${VC_TEMPLATE_REF}/${VC_CORE_PATH}}"

if ! command -v curl >/dev/null 2>&1; then
  echo "[error] curl is required to download the vc core script" >&2
  exit 1
fi

tmp="$(mktemp -t vc-core.XXXXXX)"
cleanup() {
  rm -f "$tmp"
}
trap cleanup EXIT

if ! curl -fsSL "$VC_REMOTE_URL" -o "$tmp"; then
  echo "[error] Failed to download vc core script: $VC_REMOTE_URL" >&2
  exit 1
fi

chmod +x "$tmp"
exec "$tmp" "$@"
