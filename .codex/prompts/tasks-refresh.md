---
name: Tasks Refresh
description: 全タスクの現状を棚卸しし、ドキュメントを同期しつつ残タスクの優先度・粒度を再整理する
author: codex
---

## Goal

`.design/tasks/` 内の全タスクを棚卸しし、`.design/` ドキュメントとの整合性を確保しつつ、残タスクの優先度・粒度を再整理する。調査から反映まで一気通貫で実行する。

## Important override for this run

AGENTS.md の編集制限を、以下の範囲で解除する：
- `.design/non-blocking-issues.md`（解決済みマーク追記）
- `.design/tasks/` 内の既存タスクファイル（ステータス修正・備考追記）
- `.design/tasks/` への新規タスクファイル作成（分割時）

## Process

### 1. タスク一覧の走査と分類

1. `.design/tasks/` 内の `YYYYMMDD-*.md` ファイル（`README.md` を除く）を全件読み込む
2. 各タスクの `## ステータス` セクションを確認し、以下の基準で分類する：
   - `[x] 完了` → **完了**
   - `[x] 進行中` → **進行中**
   - `[x] 未着手`（または全て未チェック） → **未着手**
3. ステータスが不明確な場合（チェックボックスの書式不正等）はフラグを立てる

### 2. 実装状況との照合

1. `git log --oneline -50` で直近のコミット履歴を取得する
2. 完了タスクについて、関連する実装が実際にコミット済みかを**補助的に**確認する
   - git log は参考情報。最終判定はタスクの完了条件チェックボックスで行う

### 3. non-blocking-issues との整合性チェック・反映

1. `.design/non-blocking-issues.md` を読み、タスク完了によって解決済みになった項目を特定する
   - 解決済み判定基準：該当タスクが完了 **かつ** 問題箇所のコードが実際に変更済み
2. 解決済み項目に取り消し線（`~~テキスト~~`）と解決日を追記する

### 4. タスクファイルの整理・反映

- ステータスが実態と不一致のタスクを修正する
- 備考セクションに依存関係等の補足を追記する
- 完了タスクのファイルを削除する（ドキュメントやガイドラインへの反映が済んでいることを確認の上）

### 5. 残タスクの分析と再整理

未着手タスクについて以下を分析し、そのまま反映する：

- **粒度**: 完了条件が4つ以上かつ横断的 → 分割（元タスクの備考に「分割先: YYYYMMDD-xxx.md」を記載し、新規ファイル作成）。完了条件が1つで独立性が低い → 統合（統合先に条件を移し、統合元は備考に「統合先」を記載して完了にする）
- **依存関係**: 他タスクの完了が前提となるものを備考に明記
- **優先度**: タスクファイルの備考セクションに以下の基準で記載
  - **高**: ブロッカーになっている / ユーザー体験に直結 / セキュリティ関連
  - **中**: 開発効率改善 / コード品質向上
  - **低**: nice-to-have / 将来対応可

### 6. .design/ 配下の変更をコミット

`.design/` 配下に差分がある場合、変更ファイルをまとめてコミットする：

```bash
git add .design/ && \
git commit -m "$(cat <<'EOF'
chore: refresh tasks and update design docs

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

差分がなければスキップする。push はしない。

### 7. 変更サマリーの報告

以下を簡潔に報告する：

```
## 棚卸し結果

### ステータス別サマリー
- 完了: N件
- 進行中: N件
- 未着手: N件

### 実施した変更
- [変更内容の一覧]

### 残タスクの優先度
- 高: [タスク一覧]
- 中: [タスク一覧]
- 低: [タスク一覧]
```

## Guardrails

- タスクのステータス判定は `## ステータス` セクション内のチェックボックスを唯一の情報源とする
- git log は補助的な証跡として使い、最終判定はタスク記述とコード差分で行う
- タスクの分割・統合時はテンプレート（`.design/tasks/README.md`）に準拠する
